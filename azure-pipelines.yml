trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- script: |
    pip install selenium pytest
  displayName: Install dependencies

- script: |
    sudo apt-get update
    sudo apt-get install -y chromium-browser chromium-chromedriver
  displayName: Install Chrome and ChromeDriver

- script: |
    cat > test_google.py << 'EOF'
    from selenium import webdriver
    from selenium.webdriver.chrome.options import Options
    from selenium.webdriver.chrome.service import Service
    
    def test_google():
        chrome_options = Options()
        chrome_options.add_argument('--headless')
        chrome_options.add_argument('--no-sandbox')
        chrome_options.add_argument('--disable-dev-shm-usage')
        chrome_options.add_argument('--disable-gpu')
        
        service = Service('/usr/bin/chromedriver')
        driver = webdriver.Chrome(service=service, options=chrome_options)
        
        driver.get('https://www.google.com')
        assert 'Google' in driver.title
        driver.quit()
    EOF
  displayName: Create test

- script: |
    pytest test_google.py --junitxml=results.xml
  displayName: Run test

- task: PublishTestResults@2
  inputs:
    testResultsFiles: results.xml
    testRunTitle: Basic Google Test
